<!DOCTYPE html>
<html>
  <head>
    
    <meta charset="UTF-8">
    <meta name="keywords" content="HTML, CSS">
    <meta name="description" content="CheckPoint">
    <meta name="author" content="Juan Ullua y Matias Vargados">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kimeiga/bahunya@css/bahunya-0.1.3.css" />
    <link rel="stylesheet" href="/frontend/pantallas-admin/css/style.css"/>
    
    <title>CheckPoint</title>

  </head>
  <body>
    <!-- menÃº principal -->
    <header>
        <ul id="listado-nav">
          <li class="links-header"><a href="admin.html"><span>Inicio</span></a></li>
          <li class="links-header"><a href="get.html"><span>ID</span></a></li>
          <li class="links-header"><a href="post.html"><span>Post</span></a></li>
          <li class="links-header"><a href="put.html"><span>Put</span></a></li>
          <li class="links-header"><a href="delete.html"><span>Delete</span></a></li>
        </ul>
    </header>

    <hr>
    <h1 class="titulo">Productos por ID</h1>
    <hr>

    <!-- lista de productos con botones -->
    <main id="contenedor-get">
      <div id="productos-container" class="crudForm-container">
        <h2>Consultar Producto</h2>
        <form id="getProduct-form">
          <label for="idProd">ID Producto</label>
          <input type="numero" name="idProd" id="idProd">

          <input type="submit" value="Consultar Producto" >
        </form>
      </div>
    </main> 

    <div id="getId-container">
      <ul id="getId-lista">

      </ul>
    </div>

    <script>
      let getId_lista = document.getElementById("getId-lista");
      let getProduct_form = document.getElementById("getProduct-form");

      getProduct_form.addEventListener("submit", async(event) =>{

        try {
          event.preventDefault(); // evitamos el envio por defecto del formulario

          // Como obtenemos y almacenamos la informacion de un formulario en js?
          let formData = new FormData(event.target);
          console.log(formData);
          
          // Obtener informacion de un formulario html y la vamos a convetir en informacion js
          let data = Object.fromEntries(formData.entries());
          console.log(data); // en teoria idProd (pero no me aparece en el panel f12)

          // Se almacena el valor numerico 
          let idProd = data.idProd;
          console.log(idProd);

          let response = await fetch(`http://localhost:3000/productos/${idProd}`);
          let datos = await response.json(); // transforma los datos en js
          console.log(datos);

          let producto = datos.payload[0]; // es el primer objeto del array

          console.log(producto.imagen);

          let htmlProducto =  `
                            <li class="li-listados productos-listados">
                              <img src="${producto.imagen}" alt="${producto.nombre}" class="img-listados">
                              <p>Id: ${producto.id} / Nombre: ${producto.nombre}/ <strong>Precio: $  ${producto.precio}</strong></p>
                            </li>
                            `;

          getId_lista.innerHTML = htmlProducto;

        } catch (error) {
          console.error("Error al obtener producto: ", error);
        }
      })

    </script>
</body>
</html>